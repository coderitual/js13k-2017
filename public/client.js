!function(){"use strict";function e(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}var t=["assets/hole.svg","assets/stamp.svg","assets/tree.svg","assets/eye.svg","assets/stamp2.svg","assets/eye_closed.svg","assets/heart.svg","assets/projectile.svg","assets/arrow.svg","assets/powerup.svg"].reduce(function(e,t){var r=document.createElement("img");return r.src=t,e[/(\w*)\.svg/g.exec(t)[1]]=r,e},{}),r=function(){function e(e,t){var r=[],o=!0,s=!1,n=void 0;try{for(var a,i=e[Symbol.iterator]();!(o=(a=i.next()).done)&&(r.push(a.value),!t||r.length!==t);o=!0);}catch(e){s=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(s)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(e,t,r){e.globalAlpha=1,e.globalCompositeOperation="source-over",e.fillStyle="#2c5b1e",e.fillRect(0,0,t,r)},s=function(e,t){e.save(),e.strokeStyle="#fff",e.lineWidth=5,e.shadowColor="#000",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.setLineDash([10,5]),e.strokeRect(0,0,t.width,t.height),e.restore()},n=function(e,t){e.save(),e.strokeStyle="#513213",e.lineWidth=2,e.shadowColor="#000",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.setLineDash([10,5]),t.forEach(function(t){var r=t.x,o=t.y,s=t.r;e.beginPath(),e.arc(r,o,s,0,2*Math.PI,!1),e.stroke()}),e.restore()},a=function(e,t){e.save(),e.strokeStyle="#e3301a",e.lineWidth=2,e.shadowColor="#000",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.setLineDash([10,5]),t.forEach(function(t){var r=t.x,o=t.y,s=t.r;e.beginPath(),e.arc(r,o,s,0,2*Math.PI,!1),e.stroke()}),e.restore()},i=[t.eye,t.eye,t.eye,t.eye,t.eye_closed],l=function(e,t,r,o){var s=i[Math.round(o/500)%5];e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.drawImage(s,t-s.width/2,r-s.height/2),e.restore()},h=function(e,r){e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.textBaseline="top",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,r.forEach(function(r){e.drawImage(t.eye,r.x-t.eye.width/2,r.y-t.eye.height/2),e.fillText(r.username,r.x,r.y+15)}),e.restore()},f=function(e,t,r){e.save(),e.beginPath(),e.arc(t,r,5,0,2*Math.PI,!1),e.fillStyle="rgba(255, 255, 255, 0.5)",e.fill(),e.lineWidth=3,e.strokeStyle="#fff",e.stroke(),e.restore()},d=function(e,t){e.save(),e.fillStyle="rgba(255, 255, 255, 1)",e.font="12px sans-serif",e.textAlign="start",e.textBaseline="top",Object.entries(t).forEach(function(t,o){var s=r(t,2),n=s[0],a=s[1];e.fillText(n+": "+a,10,10+15*o)}),e.restore()},c=function(){function e(e,t){var r=[],o=!0,s=!1,n=void 0;try{for(var a,i=e[Symbol.iterator]();!(o=(a=i.next()).done)&&(r.push(a.value),!t||r.length!==t);o=!0);}catch(e){s=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(s)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=document.getElementById("canvas"),y=u.getContext("2d"),w={x:u.width/2,y:u.height/2},g=function(){u.width=u.clientWidth,u.height=u.clientHeight,w.x=u.width/2,w.y=u.height/2};window.addEventListener("resize",g),g();var v=void 0,m=0;(v="8080"===window.location.port?io(window.location.hostname+":3000",{upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams}):io({upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams})).on("pong",function(e){m=e});var p=function(e){var t=e.id,r=e.username;return{id:t,username:void 0===r?"":r,x:0,y:0,sx:0,sy:0}},x={me:p("me"),others:new Map},b={width:0,height:0,holes:new Set,trees:new Set},S={pointer:w,players:x,world:b},O=function(e,t,r){o(y,u.width,u.height),y.save(),y.translate(u.width/2-e.players.me.x,u.height/2-e.players.me.y),a(y,e.world.holes),h(y,e.players.others),n(y,e.world.trees),s(y,e.world),y.restore(),l(y,u.width/2,u.height/2,r),f(y,e.pointer.x+u.width/2,e.pointer.y+u.height/2),d(y,{ping:m})},A=function(e,t){var r=e.players;r.me.x+=(r.me.sx-r.me.x)/5,r.me.y+=(r.me.sy-r.me.y)/5,r.others.forEach(function(e){e.x+=(e.sx-e.x)/5,e.y+=(e.sy-e.y)/5})},E=0,k=void 0;window.addEventListener("deviceorientation",function(e){k||(k={beta:e.beta,gamma:e.gamma});var t=e.beta-k.beta,r=e.gamma-k.gamma;t>90&&(t=90),-90>t&&(t=-90),w.x=u.width/2*r/90,w.y=u.height/2*t/90,v.emit("c:pointer",w)}),v.on("s:players:update",function(t){var r=t.me,o=t.others;S.players.others=new Map([].concat(e(S.players.others)).filter(function(e){var t=c(e,1)[0];return null!=o.find(function(e){return e.id===t})})),o.forEach(function(e){var t=S.players.others.get(e.id);if(!t)return t=p(e),void S.players.others.set(e.id,t);t.sx=e.x,t.sy=e.y}),S.players.me.sx=r.x,S.players.me.sy=r.y}),v.on("s:world:create",function(e){var t=e.width,r=e.height,o=e.trees,s=e.holes;S.world.width=t,S.world.height=r,S.world.trees=new Set(o),S.world.holes=new Set(s)}),function e(t){requestAnimationFrame(e);A(S),O(S,0,t),E=t}(0)}();
