!function(){"use strict";function e(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}var t={hole:"assets/hole.svg",stamp:"assets/stamp.svg",tree:"assets/tree.svg",eye:"assets/eye.svg",stamp2:"assets/stamp2.svg",eye_closed:"assets/eye_closed.svg",heart:"assets/heart.svg",projectile:"assets/projectile.svg",arrow:"assets/arrow.svg",powerup:"assets/powerup.svg"},r=function(e,t){e.save(),e.strokeStyle="#fff",e.lineWidth=5,e.shadowColor="#000",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.setLineDash([10,5]),e.strokeRect(0,0,t.width,t.height),e.restore()},a=function(){function e(e,t){var r=[],a=!0,o=!1,i=void 0;try{for(var n,s=e[Symbol.iterator]();!(a=(n=s.next()).done)&&(r.push(n.value),!t||r.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=document.createElement("img");o.src=t.hole,o.addEventListener("load",function(){var e=o.width,t=o.height;console.log({width:e,height:t})});var i=document.createElement("img");i.src=t.stamp,i.addEventListener("load",function(){var e=i.width,t=i.height;console.log({width:e,height:t})});var n=document.createElement("img");n.src=t.stamp2,n.addEventListener("load",function(){var e=n.width,t=n.height;console.log({width:e,height:t})});var s=document.createElement("img");s.src=t.tree,s.addEventListener("load",function(){var e=s.width,t=s.height;console.log({width:e,height:t})});var h=document.createElement("img");h.src=t.eye,h.addEventListener("load",function(){var e=h.width,t=h.height;console.log({width:e,height:t})});var d=document.createElement("img");d.src=t.eye_closed,d.addEventListener("load",function(){var e=d.width,t=d.height;console.log({width:e,height:t})});var l=document.createElement("img");l.src=t.powerup,l.addEventListener("load",function(){var e=l.width,t=l.height;console.log({width:e,height:t})});var c=[h,h,h,h,d],g=document.getElementById("canvas"),w=g.getContext("2d"),u={x:g.width/2,y:g.height/2},m=function(){g.width=g.clientWidth,g.height=g.clientHeight,u.x=g.width/2,u.y=g.height/2};window.addEventListener("resize",m),m();var f=void 0,v=0;(f="8080"===window.location.port?io(window.location.hostname+":3000",{upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams}):io({upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams})).on("pong",function(e){v=e});var y=function(e){var t=e.id,r=e.username;return{id:t,username:void 0===r?"":r,x:0,y:0,sx:0,sy:0}},p={me:y("me"),others:new Map},x={pointer:u,players:p,world:{width:0,height:0}},E=function(e,t,a){w.globalAlpha=1,w.globalCompositeOperation="source-over",w.fillStyle="#2c5b1e",w.fillRect(0,0,g.width,g.height),w.save(),w.translate(g.width/2-e.players.me.x,g.height/2-e.players.me.y),w.drawImage(o,0,0,200,200),w.drawImage(o,300,200,100,100),w.drawImage(l,300,50),w.drawImage(s,20,200),w.drawImage(s,250,300),w.drawImage(s,90,400,246,314),w.globalCompositeOperation="soft-light",w.drawImage(i,-100,-200,500,500),w.drawImage(n,300,200,300,300),w.globalCompositeOperation="source-over",w.save(),w.fillStyle="rgba(255, 255, 255, 0.7)",w.font="bold 12px sans-serif",w.textAlign="center",w.shadowColor="#000",w.shadowOffsetX=1,w.shadowOffsetY=1,w.shadowBlur=1,e.players.others.forEach(function(e){w.drawImage(h,e.x-h.width/2,e.y-h.height/2),w.fillText(e.username,e.x,e.y+15)}),w.restore(),r(w,e.world),w.restore();var d=c[Math.round(a/500)%5];w.drawImage(d,g.width/2-h.width/2,g.height/2-h.height/2),w.beginPath(),w.arc(e.pointer.x,e.pointer.y,5,0,2*Math.PI,!1),w.fillStyle="rgba(255, 255, 255, 0.5)",w.fill(),w.lineWidth=3,w.strokeStyle="#fff",w.stroke(),w.fillStyle="rgba(255, 255, 255, 1)",w.font="12px sans-serif",w.textAlign="start",w.textBaseline="top",w.fillText("ping: "+v,10,10)},b=function(e,t){var r=e.players;r.me.x+=(r.me.sx-r.me.x)/5,r.me.y+=(r.me.sy-r.me.y)/5,r.others.forEach(function(e){e.x+=(e.sx-e.x)/5,e.y+=(e.sy-e.y)/5})},I=0;window.addEventListener("deviceorientation",function(e){var t=e.beta,r=e.gamma;t>90&&(t=90),-90>t&&(t=-90),t+=90,r+=90,u.x=g.width*r/180,u.y=g.height*t/180,u.cw=g.width,u.ch=g.height,f.emit("c:pointer",u)}),f.on("s:players:update",function(t){var r=t.me,o=t.others;x.players.others=new Map([].concat(e(x.players.others)).filter(function(e){var t=a(e,1)[0];return null!=o.find(function(e){return e.id===t})})),o.forEach(function(e){var t=x.players.others.get(e.id);if(!t)return t=y(e),void x.players.others.set(e.id,t);t.sx=e.x,t.sy=e.y}),x.players.me.sx=r.x,x.players.me.sy=r.y}),f.on("s:world:update",function(e){var t=e.width,r=e.height;x.world.width=t,x.world.height=r}),function e(t){requestAnimationFrame(e);b(x),E(x,0,t),I=t}(0)}();
