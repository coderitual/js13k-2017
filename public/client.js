!function(){"use strict";function e(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}var t=["assets/hole.svg","assets/stamp.svg","assets/tree.svg","assets/eye.svg","assets/stamp2.svg","assets/eye_closed.svg","assets/heart.svg","assets/projectile.svg","assets/arrow.svg","assets/powerup.svg"],r=0,s=t.reduce(function(e,t){var s=document.createElement("img");return s.src=t,s.addEventListener("load",function(){r++}),e[/(\w*)\.svg/g.exec(t)[1]]=s,e},{}),o=function(){return r===t.length},n=function(){function e(e,t){var r=[],s=!0,o=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(s=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{!s&&a.return&&a.return()}finally{if(o)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(e,t,r){e.globalAlpha=1,e.globalCompositeOperation="source-over",e.fillStyle="#2c5b1e",e.fillRect(0,0,t,r)},a=function(e,t){e.save(),e.strokeStyle="#fff",e.lineWidth=5,e.shadowColor="#000",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.setLineDash([10,5]),e.strokeRect(0,0,t.width,t.height),e.restore()},l=function(e,t){e.save(),e.setLineDash([10,5]),t.forEach(function(t){var r=t.x,o=t.y,n=t.r,i=2*n/s.tree.width,a=s.tree.width*i,l=s.tree.height*i;e.drawImage(s.tree,r-n,o-n-(l-2*n),a,l)}),e.restore()},h=function(e,t){e.save(),t.forEach(function(t){var r=t.x,o=t.y,n=t.r,i=2*n/s.hole.width,a=2*n/s.hole.height,l=s.hole.width*i,h=s.hole.height*a;e.drawImage(s.hole,r-n,o-n,l,h)}),e.restore()},d=[s.eye,s.eye,s.eye,s.eye,s.eye_closed],f=function(e,t,r,s){var o=d[Math.round(s/500)%5];e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.drawImage(o,t-o.width/2,r-o.height/2),e.restore()},c=function(e,t){e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.textBaseline="top",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,t.forEach(function(t){var r=t.x,o=t.y,n=t.username;e.drawImage(s.eye,r-s.eye.width/2,o-s.eye.height/2),e.fillText(n,r,o+15)}),e.restore()},u=function(e,t){e.save(),e.fillStyle="rgba(255, 255, 255, 1)",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,t.forEach(function(t){var r=t.x,s=t.y;e.beginPath(),e.arc(r,s,3,0,2*Math.PI,!1),e.fill()}),e.restore()},y=function(e,t,r){e.save(),e.fillStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.beginPath(),e.arc(t,r,5,0,2*Math.PI,!1),e.stroke(),e.restore()},p=function(e,t,r,s){e.save(),e.fillStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.font="bold 11px sans-serif",e.textAlign="start",e.textBaseline="top",Object.entries(s).forEach(function(s,o){var i=n(s,2),a=i[0],l=i[1];e.fillText(a+": "+l,t,r+12*o)}),e.restore()},w=function(e,t,r,s){e.save(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.font="bold 14px sans-serif",e.textAlign="end",e.textBaseline="top",Object.entries(s).forEach(function(s,o){var i=n(s,2),a=i[0],l=i[1];e.fillText(a+": "+l,t,r+14*o)}),e.restore()},g=function(){function e(e,t){var r=[],s=!0,o=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(s=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{!s&&a.return&&a.return()}finally{if(o)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=document.getElementById("canvas"),m=v.getContext("2d"),x={x:v.width/2,y:v.height/2},b=function(){v.width=v.clientWidth,v.height=v.clientHeight,x.x=0,x.y=0};window.addEventListener("resize",b),b();var E=void 0,O={ping:0,fps:0,players:1,projectiles:0};(E="8080"===window.location.port?io(window.location.hostname+":3000",{upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams}):io({upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams})).on("pong",function(e){O.ping=e});var S=function(e){var t=e.id,r=e.username,s=void 0===r?"":r,o=e.kills,n=void 0===o?0:o,i=e.deaths,a=void 0===i?0:i,l=e.points,h=void 0===l?0:l,d=e.position;return{id:t,username:s,x:0,y:0,sx:0,sy:0,kills:n,deaths:a,points:h,position:void 0===d?0:d}},k=function(e){return{id:e.id,x:e.x,y:e.y,sx:0,sy:0}},j={me:S("me"),others:new Map},A=new Map,L={width:0,height:0,holes:new Set,trees:new Set},B={pointer:x,players:j,projectiles:A,world:L},C=function(e,t,r){i(m,v.width,v.height),o()&&(m.save(),m.translate(v.width/2-e.players.me.x,v.height/2-e.players.me.y),h(m,e.world.holes),u(m,e.projectiles),c(m,e.players.others),a(m,e.world),m.restore(),f(m,v.width/2,v.height/2,r),m.save(),m.translate(v.width/2-e.players.me.x,v.height/2-e.players.me.y),l(m,e.world.trees),m.restore(),y(m,e.pointer.x+v.width/2,e.pointer.y+v.height/2),p(m,10,10,O),w(m,v.width-10,10,{"#":e.players.me.position,points:e.players.me.points,kills:e.players.me.kills,deaths:e.players.me.deaths}))},I=0,X=0,Y=function(e,t){var r=e.players,s=e.projectiles;r.me.x+=(r.me.sx-r.me.x)/5,r.me.y+=(r.me.sy-r.me.y)/5,r.others.forEach(function(e){e.x+=(e.sx-e.x)/5,e.y+=(e.sy-e.y)/5}),s.forEach(function(e){e.x+=(e.sx-e.x)/5,e.y+=(e.sy-e.y)/5}),I++,(X+=t)>1e3&&(O.fps=I/X*1e3|0,I=0,X=0),O.players=e.players.others.size+1,O.projectiles=e.projectiles.size},M=0,P=!1,T=!0,W=function(e){P||(null===e.beta&&(v.classList.add("desktop"),T=!1,b()),P=!0)},R=void 0;window.addEventListener("deviceorientation",function(e){W(e),R||(R={beta:e.beta,gamma:e.gamma});var t=e.beta-R.beta,r=e.gamma-R.gamma;t>90&&(t=90),-90>t&&(t=-90),x.x=v.width/2*r/90*1.3,x.y=v.height/2*t/90*1.3,E.emit("c:pointer:update",x)}),v.addEventListener("mousemove",function(e){T||(x.x=e.clientX-v.offsetLeft-v.width/2,x.y=e.clientY-v.offsetTop-v.height/2,E.emit("c:pointer:update",x))}),document.addEventListener("mousedown",function(){T||E.emit("c:fire:pressed")}),document.addEventListener("touchstart",function(e){var t=e.touches[0],r=t.clientX,s=t.clientY;90>r&&90>s?R=null:E.emit("c:fire:pressed")}),E.on("s:players:update",function(t){var r=t.me,s=t.others;B.players.others=new Map([].concat(e(B.players.others)).filter(function(e){var t=g(e,1)[0];return null!=s.find(function(e){return e.id===t})})),s.forEach(function(e){var t=B.players.others.get(e.id);t||(t=S(e),B.players.others.set(e.id,t)),t.sx=e.x,t.sy=e.y,t.kills=e.kills,t.deaths=e.deaths,t.points=e.points,t.position=e.position}),B.players.me.sx=r.x,B.players.me.sy=r.y,B.players.me.kills=r.kills,B.players.me.deaths=r.deaths,B.players.me.points=r.points,B.players.me.position=r.position}),E.on("s:projectiles:update",function(t){B.projectiles=new Map([].concat(e(B.projectiles)).filter(function(e){var r=g(e,1)[0];return null!=t.find(function(e){return e.id===r})})),t.forEach(function(e){var t=B.projectiles.get(e.id);t||(t=k(e),B.projectiles.set(e.id,t)),t.sx=e.x,t.sy=e.y})}),E.on("s:world:create",function(e){var t=e.width,r=e.height,s=e.trees,o=e.holes;B.world.width=t,B.world.height=r,B.world.trees=new Set(s),B.world.holes=new Set(o)}),function e(t){requestAnimationFrame(e);var r=t-M;Y(B,r),C(B,0,t),M=t}(0)}();
