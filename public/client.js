!function(){"use strict";function e(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}var t={hole:"assets/hole.svg",stamp:"assets/stamp.svg",tree:"assets/tree.svg",eye:"assets/eye.svg",stamp2:"assets/stamp2.svg",eye_closed:"assets/eye_closed.svg",heart:"assets/heart.svg",projectile:"assets/projectile.svg",arrow:"assets/arrow.svg",powerup:"assets/powerup.svg"},r=function(){function e(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=document.createElement("img");a.src=t.hole,a.addEventListener("load",function(){var e=a.width,t=a.height;console.log({width:e,height:t})});var n=document.createElement("img");n.src=t.stamp,n.addEventListener("load",function(){var e=n.width,t=n.height;console.log({width:e,height:t})});var o=document.createElement("img");o.src=t.stamp2,o.addEventListener("load",function(){var e=o.width,t=o.height;console.log({width:e,height:t})});var i=document.createElement("img");i.src=t.tree,i.addEventListener("load",function(){var e=i.width,t=i.height;console.log({width:e,height:t})});var s=document.createElement("img");s.src=t.eye,s.addEventListener("load",function(){var e=s.width,t=s.height;console.log({width:e,height:t})});var l=document.createElement("img");l.src=t.eye_closed,l.addEventListener("load",function(){var e=l.width,t=l.height;console.log({width:e,height:t})});var h=document.createElement("img");h.src=t.powerup,h.addEventListener("load",function(){var e=h.width,t=h.height;console.log({width:e,height:t})});var d=[s,s,s,s,l],c=document.getElementById("canvas"),g=c.getContext("2d"),m={x:c.width/2,y:c.height/2},u=function(){c.width=c.clientWidth,c.height=c.clientHeight,m.x=c.width/2,m.y=c.height/2};window.addEventListener("resize",u),u();var w=void 0,f=0;(w="8080"===window.location.port?io(window.location.hostname+":3000",{upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams}):io({upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams})).on("pong",function(e){f=e});var v=function(e){var t=e.id,r=e.username;return{id:t,username:void 0===r?"":r,x:0,y:0,sx:0,sy:0}},y={me:v("me"),others:new Map};console.log(y);var p={pointer:m,players:y},x=function(e,t,r){g.globalAlpha=1,g.globalCompositeOperation="source-over",g.fillStyle="#2c5b1e",g.fillRect(0,0,c.width,c.height),g.save(),g.translate(c.width/2-e.players.me.x,c.height/2-e.players.me.y),g.drawImage(a,0,0,200,200),g.drawImage(a,300,200,100,100),g.drawImage(h,300,50),g.drawImage(i,20,200),g.drawImage(i,250,300),g.drawImage(i,90,400,246,314),g.globalCompositeOperation="soft-light",g.drawImage(n,-100,-200,500,500),g.drawImage(o,300,200,300,300),g.globalCompositeOperation="source-over",e.players.others.forEach(function(e){g.drawImage(s,e.x-s.width/2,e.y-s.height/2),g.fillStyle="rgba(255, 255, 255, 0.7)",g.font="bold 12px sans-serif",g.textAlign="center",g.shadowColor="black",g.shadowOffsetX=1,g.shadowOffsetY=1,g.shadowBlur=1,g.fillText(e.username,e.x,e.y+15)}),g.restore();var l=d[Math.round(r/500)%5];g.drawImage(l,c.width/2-s.width/2,c.height/2-s.height/2),g.beginPath(),g.arc(e.pointer.x,e.pointer.y,5,0,2*Math.PI,!1),g.fillStyle="rgba(255, 255, 255, 0.5)",g.fill(),g.lineWidth=3,g.strokeStyle="#fff",g.stroke(),g.fillStyle="rgba(255, 255, 255, 1)",g.font="12px sans-serif",g.textAlign="start",g.textBaseline="top",g.fillText("ping: "+f,10,10)},E=function(e,t){var r=e.players;r.me.x+=(r.me.sx-r.me.x)/5,r.me.y+=(r.me.sy-r.me.y)/5,r.others.forEach(function(e){e.x+=(e.sx-e.x)/5,e.y+=(e.sy-e.y)/5})},b=0;window.addEventListener("deviceorientation",function(e){var t=e.beta,r=e.gamma;t>90&&(t=90),-90>t&&(t=-90),t+=90,r+=90,m.x=c.width*r/180,m.y=c.height*t/180,m.cw=c.width,m.ch=c.height,w.emit("c:pointer",m)}),w.on("s:players:update",function(t){var a=t.me,n=t.others;p.players.others=new Map([].concat(e(p.players.others)).filter(function(e){var t=r(e,1)[0];return null!=n.find(function(e){return e.id===t})})),n.forEach(function(e){var t=p.players.others.get(e.id);if(!t)return t=v(e),void p.players.others.set(e.id,t);t.sx=e.x,t.sy=e.y}),p.players.me.sx=a.x,p.players.me.sy=a.y}),function e(t){requestAnimationFrame(e);E(p),x(p,0,t),b=t}(0)}();
