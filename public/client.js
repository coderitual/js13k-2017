!function(){"use strict";function e(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}function t(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}var r=["assets/hole.svg","assets/tree.svg","assets/eye.svg","assets/stamp2.svg","assets/eye_closed.svg","assets/heart.svg","assets/projectile.svg"],s=0,o=r.reduce(function(e,t){var r=document.createElement("img");return r.src=t,r.addEventListener("load",function(){s++}),e[/(\w*)\.svg/g.exec(t)[1]]=r,e},{}),i=function(){return s===r.length},a=function(){function e(e,t){var r=[],s=!0,o=!1,i=void 0;try{for(var a,n=e[Symbol.iterator]();!(s=(a=n.next()).done)&&(r.push(a.value),!t||r.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{!s&&n.return&&n.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(e){return Array(e).fill()},l=function(e,t,r,s,o,i){2*i>s&&(i=s/2),2*i>o&&(i=o/2),e.beginPath(),e.moveTo(t+i,r),e.arcTo(t+s,r,t+s,r+o,i),e.arcTo(t+s,r+o,t,r+o,i),e.arcTo(t,r+o,t,r,i),e.arcTo(t,r,t+s,r,i),e.closePath()},h=function(e,t,r){e.globalAlpha=1,e.globalCompositeOperation="source-over",e.fillStyle="#2c5b1e",e.fillRect(0,0,t,r)},f=function(e,t){e.save(),e.strokeStyle="#fff",e.lineWidth=5,e.shadowColor="#000",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.setLineDash([10,5]),e.strokeRect(0,0,t.width,t.height),e.restore()},c=function(e,t){e.save(),e.setLineDash([10,5]),t.forEach(function(t){var r=t.x,s=t.y,i=t.r,a=2*i/o.tree.width,n=o.tree.width*a,l=o.tree.height*a;e.drawImage(o.tree,r-i,s-i-(l-2*i),n,l)}),e.restore()},d=function(e,t){e.save(),t.forEach(function(t){var r=t.x,s=t.y,i=t.r,a=2*i/o.hole.width,n=2*i/o.hole.height,l=o.hole.width*a,h=o.hole.height*n;e.drawImage(o.hole,r-i,s-i,l,h)}),e.restore()},u=[o.eye,o.eye,o.eye,o.eye,o.eye_closed],y=function(e,t,r,s){var o=u[Math.round(s/500)%5];e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.drawImage(o,t-o.width/2,r-o.height/2),e.restore()},p=function(e,t){e.save(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="bold 12px sans-serif",e.textAlign="center",e.textBaseline="top",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,t.forEach(function(t){var r=t.x,s=t.y,i=t.username,a=t.r,n=2*a/o.eye.width,l=o.eye.width*n,h=o.eye.height*n;e.drawImage(o.eye,r-a,s-a-(h-2*a),l,h),e.fillText(i,r,s+a)}),e.restore()},w=function(e,t){e.save(),e.fillStyle="rgba(255, 255, 255, 1)",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,t.forEach(function(t){var r=t.x,s=t.y;e.beginPath(),e.arc(r,s,3,0,2*Math.PI,!1),e.fill()}),e.restore()},g=function(e,t,r){e.save(),e.fillStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.beginPath(),e.arc(t,r,5,0,2*Math.PI,!1),e.stroke(),e.restore()},v=function(e,t,r,s){e.save(),e.fillStyle="rgba(255, 255, 255, 1)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.font="bold 13px sans-serif",e.textAlign="start",e.textBaseline="top";var o="";n(s).forEach(function(){o+="💗"}),e.fillText(o,t,r),e.restore()},m=function(e,t,r,s){e.save(),e.fillStyle="rgba(255, 255, 255, 1)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.font="bold 13px sans-serif",e.textAlign="start",e.textBaseline="top";var o="";n(s).forEach(function(){o+="🔥"}),e.fillText(o,t,r),e.restore()},x=function(e,t,r,s){e.save(),e.fillStyle="rgba(255, 255, 255, 0.4)",e.lineWidth=3,e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=2,e.font="bold 11px sans-serif",e.textAlign="start",e.textBaseline="top",Object.entries(s).forEach(function(s,o){var i=a(s,2),n=i[0],l=i[1];e.fillText(n+": "+l,t,r+12*o)}),e.restore()},b=function(t,r,s,o){t.save(),t.strokeStyle="#fff",t.shadowColor="rgba(0, 0, 0, 1)",t.shadowOffsetX=1,t.shadowOffsetY=1,t.shadowBlur=2,t.font="bold 11px sans-serif",t.textAlign="right",t.textBaseline="bottom",[].concat(e(o)).reverse().forEach(function(e,i){var a=e.me,n=e.username,l=e.points;t.fillStyle=a?"rgba(255, 255, 255, 0.8)":"rgba(255, 255, 255, 0.5)",t.fillText(o.size-i+". "+n+" • 🏆 "+l,r,s+-13*i)}),t.restore()},S=function(e,t,r,s){var o=s.points,i=s.kills,a=s.deaths,n=s.position;e.save(),e.strokeStyle="#fff",e.shadowColor="rgba(0, 0, 0, 1)",e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowBlur=1,e.font="bold 14px sans-serif",e.textAlign="center",e.textBaseline="center";var h="🏅 "+n+" • 🏆 "+o+" • 🎯 "+i+" • ☠️ "+a,f=e.measureText(h);e.fillStyle="rgba(0, 0, 0, 0.2)",l(e,t-f.width/2-10,r-16,f.width+20,22,10),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillText(h,t,r),e.restore()},O=function(){function e(e,t){var r=[],s=!0,o=!1,i=void 0;try{for(var a,n=e[Symbol.iterator]();!(s=(a=n.next()).done)&&(r.push(a.value),!t||r.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{!s&&n.return&&n.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),j=document.getElementById("canvas"),A=j.getContext("2d"),E={x:j.width/2,y:j.height/2},k=function(){j.width=j.clientWidth,j.height=j.clientHeight,E.x=0,E.y=0};window.addEventListener("resize",k),k();var B=void 0,T={version:"1.1.0",ping:0,fps:0,players:1,projectiles:0,trees:0,holes:0};(B="8080"===window.location.port?io(window.location.hostname+":3000",{upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams}):io({upgrade:!1,transports:["websocket"],query:""+new URL(window.location).searchParams})).on("pong",function(e){T.ping=e});var C=function(e){var t=e.id,r=e.username,s=void 0===r?"":r,o=e.me,i=void 0!==o&&o,a=e.kills,n=void 0===a?0:a,l=e.deaths,h=void 0===l?0:l,f=e.points,c=void 0===f?0:f,d=e.position,u=void 0===d?0:d,y=e.health,p=void 0===y?0:y,w=e.projectiles;return{id:t,username:s,me:i,x:0,y:0,r:0,scale:1,sx:0,sy:0,kills:n,deaths:h,points:c,position:u,health:p,projectiles:void 0===w?0:w}},X=function(e){return{id:e.id,x:e.x,y:e.y,sx:0,sy:0}},Y={me:null,others:new Map,sorted:new Set},L=new Map,I={width:0,height:0,holes:new Set,trees:new Set},P={pointer:E,players:Y,projectiles:L,world:I},M=function(e,t,r){if(h(A,j.width,j.height),i()){var s=e.players.me,o=s.x,a=s.y,n=s.scale;A.save(),A.translate(-o/n+j.width/2,-a/n+j.height/2),A.scale(1/n,1/n),d(A,e.world.holes),w(A,e.projectiles),p(A,e.players.others),f(A,e.world),A.restore(),y(A,j.width/2,j.height/2,r),A.save(),A.translate(-o/n+j.width/2,-a/n+j.height/2),A.scale(1/n,1/n),c(A,e.world.trees),A.restore(),g(A,e.pointer.x+j.width/2,e.pointer.y+j.height/2),v(A,10,j.height-50,e.players.me.health),m(A,10,j.height-30,e.players.me.projectiles),b(A,j.width-10,j.height-10,e.players.sorted),x(A,10,10,T),S(A,j.width/2,25,{position:e.players.me.position,points:e.players.me.points,kills:e.players.me.kills,deaths:e.players.me.deaths})}},W=0,z=0,R=function(e,r){var s=e.players,o=e.projectiles;s.me.x+=(s.me.sx-s.me.x)/2,s.me.y+=(s.me.sy-s.me.y)/2,s.me.scale+=(s.me.sscale-s.me.scale)/10,s.others.forEach(function(e){e.x+=(e.sx-e.x)/2,e.y+=(e.sy-e.y)/2}),o.forEach(function(e){e.x+=(e.sx-e.x)/2,e.y+=(e.sy-e.y)/2}),W++,(z+=r)>1e3&&(T.fps=W/z*1e3|0,W=0,z=0),T.players=e.players.others.size+1,T.projectiles=e.projectiles.size,e.players.sorted=new Set([e.players.me].concat(t([].concat(t(e.players.others)).map(function(e){var t=O(e,2);return t[1]}))).sort(function(e,t){return e.position-t.position}))},q=0,D=void 0;window.addEventListener("deviceorientation",function(e){D||(D={beta:e.beta,gamma:e.gamma});var t=e.beta-D.beta,r=e.gamma-D.gamma;t>90&&(t=90),-90>t&&(t=-90),E.x=j.width/2*r/90*1.5,E.y=j.height/2*t/90*1.5,B.emit("c:pointer:update",E)}),j.addEventListener("mousemove",function(e){device.mobile()||(E.x=e.clientX-j.offsetLeft-j.width/2,E.y=e.clientY-j.offsetTop-j.height/2,B.emit("c:pointer:update",E))}),document.addEventListener("mousedown",function(){device.mobile()||B.emit("c:fire:press")}),document.addEventListener("touchstart",function(e){var t=e.touches[0],r=t.clientX,s=t.clientY;90>r&&90>s?D=null:B.emit("c:fire:press")}),B.on("s:players:update",function(e){var r=e.me,s=e.others;P.players.others=new Map([].concat(t(P.players.others)).filter(function(e){var t=O(e,1)[0];return null!=s.find(function(e){return e.id===t})})),s.forEach(function(e){var t=P.players.others.get(e.id);t||(t=C(e),P.players.others.set(e.id,t)),t.sx=e.x,t.sy=e.y,t.r=e.r,t.sscale=e.scale,t.kills=e.kills,t.deaths=e.deaths,t.points=e.points,t.position=e.position,t.health=e.health,t.projectiles=e.projectiles}),P.players.me||(P.players.me=C(r)),P.players.me.sx=r.x,P.players.me.sy=r.y,P.players.me.r=r.r,P.players.me.sscale=r.scale,P.players.me.kills=r.kills,P.players.me.deaths=r.deaths,P.players.me.points=r.points,P.players.me.position=r.position,P.players.me.health=r.health,P.players.me.projectiles=r.projectiles}),B.on("s:projectiles:update",function(e){P.projectiles=new Map([].concat(t(P.projectiles)).filter(function(t){var r=O(t,1)[0];return null!=e.find(function(e){return e.id===r})})),e.forEach(function(e){var t=P.projectiles.get(e.id);t||(t=X(e),P.projectiles.set(e.id,t)),t.sx=e.x,t.sy=e.y})}),B.on("s:world:create",function(e){var t=e.width,r=e.height,s=e.trees,o=e.holes;P.world.width=t,P.world.height=r,P.world.trees=new Set(s),P.world.holes=new Set(o),T.trees=s.length,T.holes=o.length}),function e(t){if(requestAnimationFrame(e),P.players.me){var r=t-q;R(P,r),M(P,0,t),q=t}}(0)}();
